
SLEEP 1000

PRINTLN MAP [ ADD 1 ] MAP [ CALL  ] DOUBLES

BIND DOUBLES => MAP [ CALLA DOUBLER ] RANGE 1 100

DEFINE CALLA => [  
	->FUNC [ 
		VAL
		WHEN NOT DONE
			THIN [ 
				REBIND VAL => READQ RQ
				REBIND DONE => TRUE
			] 
	]
	WRITEQ AC H[ FARG => URL RET => RQ ]H
	BIND RQ => NEWQUEUE
	BIND DONE => FALSE
	BIND VAL => FALSE
	BIND URL =>
	BIND AC =>
]

BIND DOUBLER => ACTOR [ MULT 2 ]





DEFINE ACTOR => [
	WQ
	THREAD [
		FOREVER [ WRITEQ RETQ CALL USERFUNC  FARG 
		BIND RETQ => GETHASH RET => PARAMS
		BIND FARG => GETHASH FARG => PARAMS
		BIND PARAMS => READQ WQ
		]
	]
	BIND WQ NEWQUEUE
	BIND USERFUNC =>
]



ITERATE [ LOG ] RANGE 1 100

LOG [ HELLO ]

BIND LOG => MIME [ PRINTLN  ]



DEFINE MIME => [
	->FUNC [ WRITEQ Q ] 
	THREAD [
		FOREVER [ CALL USERFUNC  READQ Q ]
	]
	BIND Q NEWQUEUE
	BIND USERFUNC =>
]

DEFINE FOREVER => [ FOREVER CALL DUP ]